---
title: 웹 브라우저의 리소스 우선순위
date: 2023-08-27
description: 그리고 preload와 preconnect에 대해 알아보기
thumbnail: https://drive.google.com/uc?export=view&id=1CSHLSoTTs06w0YVrSgQPTJL7zDLC8B3v
---

**이 글은 [Fetch Priority](https://web.dev/fetch-priority/)를 정리한 내용입니다.**

웹 브라우저는 `HTML`을 가져오고, 위에서 부터 아래로 분석하며 이미지, 스크립트, CSS와 같은 리소스를 탐색하고 다운로드하기 시작할 때,
리소스를 최적의 순서로 다운로드하기 위해 해당 리소스에 가져오기(fetch) 우선순위를 할당한다.

이러한 우선순위는 리소스의 종류와 `HTML` 내 위치에 따라 달라질 수 있다. 예를 들어,

뷰포트 내에 존재하는 이미지는 높은 우선순위를 가질 수 있으며,
`<head />` 내 `<link />`를 통해 조기에 로드되는 렌더링 차단 CSS의 경우 매우 높은 우선순위를 가질 수 있다.
브라우저는 이러한 우선순위를 알잘딱깔센으로 잘 정해주지만, 항상 완벽한 것은 아니다.

## 리소스 우선순위

리소스 가져오기 순서는 페이지의 모든 리소스에 대해 브라우저가 할당한 우선순위에 따라 달라진다.
다양한 요소들이 우선순위 계산 로직에 영향을 미친다. 예를 들어,

- CSS, 폰트, 자바스크립트, 이미지 및 써드파티 리소스는 각각 다른 우선순위를 할당 받는다.
- HTML 내에서 리소스를 참조하는 위치나 순서도 리소스의 우선순위에 영향을 준다.
- `preload` 리소스 힌트는 브라우저가 리소스를 더 빠르게 발견하도록 도와주어 문서가 로드되기 전에 해당 리소스를 미리 로드하며 우선순위에 도움을 준다.
- `async` 또는 `defer` 자바스크립트 파일의 경우 우선순위 계산이 변경된다.

[리소스 우선순위에 대한 테이블은 여기서 확인하면 된다.](https://web.dev/fetch-priority/#resource-priority)

## preload로 주요 리소스 미리 로드하기

- `preload`를 사용하면 리소스를 빨리 가져와야 한다는 것을 브라우저에게 알릴 수 있으며 `as` 속성을 사용하여 브라우저에게 리소스의 유형을 알려야한다.

```html
<link
  rel="preload"
  as="script"
  href="critical.js"
/>
```

## preconnect로 외부 리소스 빨리 가져오기

- `preconnect`는 Cross-Origin 서버와의 연결을 미리 활성화하여 `Time-to-first-byte`와 같은 지표를 개선하는 데 도움이 되며, 필요한 리소스의 정확한 URL을 모르더라도 해당 출처를 알고 있는 경우 유용하다.
  - 미리 연결된 리소스는 빠르게 접근할 수 있게 되어 리소스 로드 시간을 줄일 수 있다.
- 아래와 같이 `preconnect API`를 사용하면, 브라우저는 페이지가 `example.com`에 연결되고 `example.com`에서 리소스를 가져올 것이라는 것을 알 수 있다.

```html
<link
  rel="preconnect"
  href="example.com"
/>
```

- 활용 사례로는 미디어 스트리밍이 있다.

  - `preconnect`는 미리 연결을 하기 때문에 리소스를 가져올 준비가 되면 연결을 설정하는 것이 아니라 미리 연결된 설정에 따라 리소스를 가져와 연결을 설정하는 대기 시간을 줄 일 수 있다.
  - 예를 들어, 유튜브 동영상 리소스를 가져올 때는 아래와 같이 설정할 수 있다.

```html
<link
  rel="preconnect"
  href="https://www.youtube.com"
/>
```

```text
preload와 preconnect는 모든 최신 브라우저에서 지원된다(2023.08.27 기준).
```

`HTML` 내에 리소스 명시 순서를 정하여 리소스를 가져오는 우선순위를 설정하는 법과 자바스크립트 파일의 경우 `async`나 `defer` API를 사용하는 것은 해보았지만,
`preload`와 `preconnect`에 대해서는 알고 있지 못했는데 굉장히 유용한 API인 것 같다.
